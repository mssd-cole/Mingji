<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Shantell+Sans&display=swap"
      rel="stylesheet"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="mainstyles.css" />
    <title>User Page</title>
    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBq13UT4HLyTM4iDP9pc_NzfvewcqyZBwk",
        authDomain: "mingji-605c7.firebaseapp.com",
        databaseURL:
          "https://mingji-605c7-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "mingji-605c7",
        storageBucket: "mingji-605c7.firebasestorage.app",
        messagingSenderId: "432577152055",
        appId: "1:432577152055:web:74002d06550975938e2bb2",
        measurementId: "G-J2TWZ4WMJS",
      };
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth(app);
    </script>
  </head>
  <body>
    <header>
      <div class="web-name">Mingji</div>

      <div class="profile-picture-header">
        <img
          src="path/to/profile.jpg"
          alt="Profile Picture"
          id="profileImageHeader"
          onclick="toggleProfileMenu()"
        />

        <!-- Profile settings menu -->
        <div class="profile-settings-menu">
          <button onclick="triggerProfileChange('picture')">
            Change Profile Picture
          </button>
          <button onclick="triggerProfileChange('name')">Change Name</button>
          <button onclick="triggerProfileChange('password')">
            Change Password
          </button>
          <button id="logout-button" onclick="logout()">Logout</button>
        </div>
      </div>
    </header>

    <!-- Modal for Changing Name -->
    <div id="name-modal" class="modal">
      <div class="modal-content">
        <h3>Change Name</h3>
        <input type="text" id="new-name" placeholder="Enter new name" />
        <button onclick="saveName()">Save</button>
        <button onclick="closeNameModal()">Cancel</button>
      </div>
    </div>

    <!-- Modal for Changing Password -->
    <div id="password-modal" class="modal">
      <div class="modal-content">
        <h3>Change Password</h3>
        <input
          type="password"
          id="new-password"
          placeholder="Enter new password"
        />
        <input
          type="password"
          id="re-enter-password"
          placeholder="Re-enter password"
        />
        <button onclick="savePassword()">Save</button>
        <button onclick="closePasswordModal()">Cancel</button>
      </div>
    </div>

    <div class="container">
      <!-- Sidebar with Profile, Bio, and Buttons -->
      <div class="sidebar">
        <!-- Profile Section -->
        <div class="profile-section">
          <!-- Profile Picture -->
          <img
            src="default-profile.jpg"
            id="profileImageSidebar"
            alt="Profile Picture"
            class="profile-picture"
          />
          <p id="editable-name">User Name</p>
          <!-- Name will be dynamically updated -->
          <button onclick="triggerProfileChange('name')">Change Name</button>
          <button onclick="triggerProfileChange('picture')">Change Picture</button>
        </div>
      
        <!-- Bio Section -->
        <div id="bio-text">Your bio will appear here.</div>
        <input type="text" id="bio" style="display: none" />
        <div class="edit-bio-buttons" style="display: none">
          <button onclick="saveBio()">Save</button>
          <button onclick="cancelBio()">Cancel</button>
        </div>
        <button onclick="editBio()">Edit Bio</button>
      
        <!-- Sidebar Buttons -->
        <div class="sidebar-buttons">
          <button>Bookmark</button>
          <a href="note.html" class="write-button">Write</a>
          <button id="add-button" onclick="toggleModal()">Add Memory</button>
          <!-- Added Logout Button -->
          <button id="logout-button" onclick="logout()">Logout</button>
        </div>
      </div>
      
      
      <!-- Modal for Name Change -->
      <div id="name-modal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeNameModal()">&times;</span>
          <h3>Change Name</h3>
          <input type="text" id="new-name" placeholder="Enter new name" />
          <button onclick="saveName()">Save</button>
          <button onclick="closeNameModal()">Cancel</button>
        </div>
      </div>

      <!-- Modal for Profile Picture Change -->
      <div id="change-picture-modal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closePictureModal()">&times;</span>
          <h3>Upload Profile Picture</h3>
          <input
            type="file"
            id="profile-picture-upload"
            onchange="changeProfileImage(event)"
          />
          <button onclick="closePictureModal()">Close</button>
        </div>
      </div>

      <input
        type="file"
        id="profile-upload"
        style="display: none"
        onchange="changeProfileImage(event)"
      />

      <!-- Main Content -->
      <div class="main-content">
        <div class="photo-nav">
          <div class="highlight">
            <button class="highlight-btn">
              <img src="https://via.placeholder.com/50" alt="Add" />
            </button>
            <a
              href="addfeaturedphoto.html"
              class="https://via.placeholder.com/50"
              >Add</a
            >
          </div>
          <div class="highlight">
            <button class="highlight-btn">
              <img src="https://via.placeholder.com/50" alt="Family" />
            </button>
            <p>Family</p>
          </div>
          <div class="highlight">
            <button class="highlight-btn">
              <img src="https://via.placeholder.com/50" alt="Friends" />
            </button>
            <p>Friends</p>
          </div>
          <div class="highlight">
            <button class="highlight-btn">
              <img src="https://via.placeholder.com/50" alt="Travel" />
            </button>
            <p>Travel</p>
          </div>
          <div class="highlight">
            <button class="highlight-btn">
              <img src="https://via.placeholder.com/50" alt="Studies" />
            </button>
            <p>Studies</p>
          </div>
        </div>

        <!-- Add Post Form -->
        <div class="add-post-form" id="add-post-form">
          <input type="file" id="post-file" accept="image/*,audio/*" />
          <textarea
            id="post-caption"
            placeholder="Write a caption..."
          ></textarea>
          <button onclick="addPost()">Add Post</button>
        </div>

        <!-- Photo Grid -->
        <div class="photo-grid" id="photo-grid">
          <!-- Posts will appear here -->
        </div>
      </div>
    </div>

    <!-- Modal for Adding Memory -->
    <div class="modal" id="memory-modal">
      <div class="modal-content">
        <h3>Add Memory</h3>
        <div class="modal-form">
          <div class="input-group">
            <label for="memory-photo">
              <i class="fa fa-camera"></i> Add Photo/Video
            </label>
            <input type="file" id="memory-photo" accept="image/*, video/*" />
          </div>
          <div class="input-group">
            <label for="memory-music">
              <i class="fa fa-music"></i> Add Music
            </label>
            <input type="file" id="memory-music" accept="audio/*" />
          </div>
          <div class="input-group">
            <label for="memory-caption">Caption</label>
            <textarea
              id="memory-caption"
              placeholder="Write a caption..."
            ></textarea>
          </div>
        </div>
        <div class="modal-buttons">
          <button onclick="saveMemory()">Save Memory</button>
          <button onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>
    <script>
      // Logout functionality with error handling
      function logout() {
        const confirmLogout = confirm("Are you sure you want to log out?");
        if (confirmLogout) {
          auth.signOut()
            .then(() => {
              alert("You have logged out successfully!");
              // Redirect to login page
              window.location.href = "login.html"; // Replace 'login.html' with your actual login page URL
            })
            .catch((error) => {
              console.error("Error during logout:", error.message);
              alert("An error occurred while logging out. Please try again.");
            });
        }
      }

      // Toggle Memory Modal
      function toggleModal() {
        const modal = document.getElementById("memory-modal");
        modal.style.display =
          modal.style.display === "none" || modal.style.display === ""
            ? "flex"
            : "none";
      }

      // Close Memory Modal
      function closeModal() {
        const modal = document.getElementById("memory-modal");
        modal.style.display = "none";
      }

      // Save Memory (photo, music, caption)
      function saveMemory() {
        const photo = document.getElementById("memory-photo").files[0];
        const music = document.getElementById("memory-music").files[0];
        const caption = document.getElementById("memory-caption").value;

        if (!photo && !music) {
          alert("Please provide a photo, music, or video and a caption.");
          return;
        }

        const memoryDate = new Date();
        const memory = {
          photo: photo ? URL.createObjectURL(photo) : null,
          music: music ? URL.createObjectURL(music) : null,
          video:
            photo && photo.type.startsWith("video")
              ? URL.createObjectURL(photo)
              : null,
          caption,
          date: memoryDate.toLocaleDateString(),
        };

        addMemoryToGrid(memory);
        closeModal();
      }

      // Toggle Profile Menu
      function toggleProfileMenu() {
        const menu = document.querySelector(".profile-settings-menu");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      }

      // Handle Profile Changes (trigger modals)
      function triggerProfileChange(type) {
        if (type === "picture") {
          document.getElementById("profile-upload").click(); // Trigger file upload
        } else if (type === "name") {
          openNameModal(); // Open name change modal
        } else if (type === "password") {
          openPasswordModal(); // Open password change modal
        }
      }

      // Change Profile Picture (Header and Sidebar)
      function changeProfileImage(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // Update Profile Picture in Header
            document.getElementById("profileImageHeader").src = e.target.result;
            // Update Profile Picture in Sidebar
            document.querySelector(".profile-picture img").src =
              e.target.result;
          };
          reader.readAsDataURL(file);
        }
      }

      // Open Name Change Modal
      function openNameModal() {
        document.getElementById("name-modal").style.display = "block";
      }

      // Save New Name
      function saveName() {
        const newName = document.getElementById("new-name").value;
        if (newName) {
          // Update the Profile Name in Header and Sidebar
          document.getElementById("editable-name").textContent = newName;
          alert(`Name changed to: ${newName}`);
          closeNameModal();
        }
      }

      // Close Name Change Modal
      function closeNameModal() {
        document.getElementById("name-modal").style.display = "none";
      }

      // Open Password Change Modal
      function openPasswordModal() {
        document.getElementById("password-modal").style.display = "block";
      }

      // Save New Password
      function savePassword() {
        const newPassword = document.getElementById("new-password").value;
        const reEnterPassword =
          document.getElementById("re-enter-password").value;

        if (newPassword !== reEnterPassword) {
          alert("Passwords do not match. Please try again.");
          return;
        }

        alert("Password changed successfully!");
        closePasswordModal();
      }

      // Close Password Change Modal
      function closePasswordModal() {
        document.getElementById("password-modal").style.display = "none";
      }

      function logout() {
        try {
          // Redirect to the login page
          window.location.href = "login.html"; // Replace with the correct path to your login page
        } catch (error) {
          console.error("Error during logout:", error);
          alert("An error occurred while logging out. Please try again.");
        }
      }
    
      // Add an event listener for the logout button (if dynamically loaded)
      document.addEventListener("DOMContentLoaded", () => {
        const logoutButton = document.getElementById("logout-button");
        if (logoutButton) {
          logoutButton.addEventListener("click", logout);
        } else {
          console.error("Logout button not found.");
        }
      });
      // Add Memory to Grid (Display Memory in Grid)
      function addMemoryToGrid(memory) {
        const grid = document.getElementById("photo-grid");

        // Create Memory Card
        const card = document.createElement("div");
        card.classList.add("photo-card");
        card.style.position = "relative"; // Ensure positioning for the menu

        // Create Content Container
        const contentContainer = document.createElement("div");
        contentContainer.classList.add("content-container");
        card.appendChild(contentContainer);

        // Create More Options Button
        const moreOptionsBtn = document.createElement("button");
        moreOptionsBtn.textContent = "⋮";
        moreOptionsBtn.classList.add("more-options-btn");
        card.appendChild(moreOptionsBtn);

        // Create Delete Menu
        const deleteMenu = document.createElement("div");
        deleteMenu.classList.add("delete-menu");
        deleteMenu.innerHTML = `<p class="delete-option">Delete Memory</p>`;
        card.appendChild(deleteMenu);

        // Toggle Delete Menu
        moreOptionsBtn.addEventListener("click", () => {
          deleteMenu.classList.toggle("visible");
        });

        // Delete Memory
        deleteMenu
          .querySelector(".delete-option")
          .addEventListener("click", () => {
            card.remove();
          });

        // Add Photo or Video Content
        if (memory.video) {
          const video = document.createElement("video");
          video.controls = true;
          video.src = memory.video;
          contentContainer.appendChild(video);
        } else if (memory.photo) {
          const img = document.createElement("img");
          img.src = memory.photo;
          contentContainer.appendChild(img);
        }

        // Add Music Content (Audio)
        if (memory.music) {
          const audio = document.createElement("audio");
          audio.controls = true;
          audio.src = memory.music;
          contentContainer.appendChild(audio);
        }

        // Add Caption
        const caption = document.createElement("p");
        caption.textContent = memory.caption;
        contentContainer.appendChild(caption);

        // Append the card to the photo grid
        grid.appendChild(card);
      }

      // Edit Bio functionality
      function editBio() {
        // Hide the displayed bio text
        document.getElementById("bio-text").style.display = "none";

        // Show the input field to edit bio
        document.getElementById("bio").style.display = "block";

        // Show the save and cancel buttons
        document.querySelector(".edit-bio-buttons").style.display = "flex";
      }

      // Save Bio
      function saveBio() {
        // Get the input bio value
        const bio = document.getElementById("bio").value;

        // Update the bio text, or display a default message if empty
        document.getElementById("bio-text").textContent = bio || "No bio added";

        // Hide the input field and show the updated bio text
        document.getElementById("bio-text").style.display = "block";
        document.getElementById("bio").style.display = "none";

        // Hide the save/cancel buttons
        document.querySelector(".edit-bio-buttons").style.display = "none";
      }

      // Cancel Bio Edit
      function cancelBio() {
        // Hide the input field
        document.getElementById("bio").style.display = "none";

        // Hide the save/cancel buttons
        document.querySelector(".edit-bio-buttons").style.display = "none";

        // Show the original bio text
        document.getElementById("bio-text").style.display = "block";
      }
    </script>
  </body>
</html>
